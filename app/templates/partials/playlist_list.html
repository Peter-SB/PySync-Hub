<form id="playlist-form" class="space-y-2">
    {% for playlist in playlists %}
    <div id="playlist-{{ playlist.id }}" class="flex items-center p-4 bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow">
        <input type="checkbox" name="playlist_ids" value="{{ playlist.id }}"
               class="mr-4 h-4 w-4"
               {% if playlist.id|string in selected_ids %}checked{% endif %}>

        {% if playlist.image_url %}
        <img src="{{ playlist.image_url }}" alt="Playlist cover"
             class="w-14 h-14 rounded-lg object-cover mr-4"
        >
        {% endif %}

        <div class="flex-1">
            <h3 class="font-medium text-gray-900 flex items-center">
                <!-- Playlist Title as Link -->
                <a href="{{ playlist.url }}" target="_blank" class="hover:underline">
                    {{ playlist.name }}
                </a>
                <!-- Display Spotify or SoundCloud Icon -->
                {% if playlist.platform == "spotify" %}
                    <img src="/static/icons/spotify.svg" alt="Spotify" class="w-5 h-5">
                {% elif playlist.platform == "soundcloud" %}
                    <img src="/static/icons/soundcloud.svg" alt="SoundCloud" class="w-5 h-5">
                {% endif %}
            </h3>
            <div class="text-sm text-gray-500">
                <span>{{ playlist.platform|title }}</span>
                {% if playlist.last_synced %}
                <span>â€¢ Last synced: {{ playlist.last_synced.strftime('%Y-%m-%d %H:%M') }}</span>
                {% endif %}
            </div>
        </div>

        <div class="text-sm text-gray-500 ml-auto p-4">
            {{ playlist.track_count }} songs
        </div>

        <!-- Conditional UI based on download_status -->
        <div id="download-status-{{ playlist.id }}">
            {% if playlist.download_status == 'queued' %}
                <span class="text-yellow-500 font-bold">Queued</span>
                <button onclick="cancelDownload({{ playlist.id }})"
                        class="px-2 py-1 bg-red-600 text-white rounded">
                    Cancel
                </button>
            {% elif playlist.download_status == 'downloading' %}
                <div class="flex items-center">
                    <div class="w-32 bg-gray-300 rounded-full h-2 mr-2">
                        <div id="progress-bar-{{ playlist.id }}"
                             class="bg-blue-500 h-2 rounded-full"
                             style="width: 0%;">
                        </div>
                    </div>
                    <button onclick="cancelDownload({{ playlist.id }})"
                            class="px-2 py-1 bg-red-600 text-white rounded">
                        Cancel
                    </button>
                </div>
            {% else %}
                <button type="button"
                        hx-post="/playlists/refresh"
                        hx-vals='{"playlist_ids": [{{ playlist.id }}]}'
                        hx-target="#playlist-list"
                        class="px-3 py-1 text-sm bg-gray-100 rounded-lg hover:bg-gray-200">
                    Sync
                </button>
            {% endif %}
        </div>
    </div>
    {% else %}
    <div class="p-4 text-center text-gray-500 bg-white rounded-lg">
        No playlists added yet
    </div>
    {% endfor %}
</form>
